\ProvidesPackage{slide-zh}[2024/02/17 Custom style for Chinese presentations]

%% ============================================
%% Presentation and layout packages
%% ============================================
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{pdfpages}
\usepackage{multicol}

%% ============================================
%% Math and graphics support
%% ============================================
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
% Load TikZ only when needed to improve compilation speed
\usepackage{tikz}
% Load pgfplots with minimal settings for faster compilation
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

%% ============================================
%% Table and figure enhancements
%% ============================================
\usepackage{booktabs}
\usepackage{subcaption}
\usepackage{multirow}

%% ============================================
%% Presentation-specific packages
%% ============================================
% Use simpler tcolorbox settings for faster compilation
\usepackage[most]{tcolorbox}
\usepackage{animate}
\usepackage{multimedia}
\usepackage{listings}
\usepackage{enumitem}

%% ============================================
%% Reference and citation support
%% ============================================
\usepackage{url}         % For formatting URLs
\usepackage{doi}         % For handling DOIs

%% ============================================
%% Hyperlink and PDF properties
%% ============================================
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  filecolor=blue,
  urlcolor=blue,
  citecolor=blue
}

%% ============================================
%% Chinese language support with more robust font settings
%% ============================================
\usepackage{ctex}

% Improved Chinese font configuration with fallbacks
\setCJKmainfont{STSong}
\setCJKsansfont{STKaiti}  % Better sans-serif font for Chinese
\setCJKmonofont{STFangsong}  % Better monospace font for Chinese

%% ============================================
%% Beamer theme and appearance
%% ============================================
% If used with beamer class, these settings will help customize it
% Define book paper color
% bookpaper theme
\definecolor{bookpaper}{RGB}{253,245,230} % Light cream/off-white color for book paper
\definecolor{tocheading}{RGB}{70,30,0} % Dark brown for TOC headings
\definecolor{tocsection}{RGB}{120,60,10} % Medium brown for section entries
\definecolor{tocsubsection}{RGB}{140,80,20} % Lighter brown for subsection entries

\AtBeginDocument{%
  \@ifclassloaded{beamer}{%
    % Beamer-specific settings
    \usetheme{Madrid}
    \usecolortheme{dolphin}
    \setbeamertemplate{navigation symbols}{}  % Hide navigation symbols
    \setbeamertemplate{caption}[numbered]     % Numbered captions

    % Customize beamer colors for Chinese presentations
    \setbeamercolor{title}{fg=black}
    \setbeamercolor{frametitle}{fg=black} % Removed bg=lightgray!20 to eliminate background color

    % Beamer TOC formatting
    \setbeamercolor{section in toc}{fg=tocsection}
    \setbeamercolor{subsection in toc}{fg=tocsubsection}
    \setbeamertemplate{section in toc}{\inserttocsectionnumber.~\inserttocsection\par}
    \setbeamertemplate{subsection in toc}{\leavevmode\leftskip=2em\inserttocsubsection\par}

    % Beamer-specific background setting
    \setbeamercolor{background canvas}{bg=bookpaper}

    % Set block colors
    \setbeamercolor{block title}{bg=tocheading!20!bookpaper, fg=tocheading}
    \setbeamercolor{block body}{bg=bookpaper!80!white, fg=black}

    \setbeamercolor{block title alerted}{bg=red!60!bookpaper, fg=black}
    \setbeamercolor{block body alerted}{bg=red!5!bookpaper, fg=black}

    % Fix example blocks
    \setbeamercolor{block title example}{bg=tocsection!60!bookpaper, fg=black}
    \setbeamercolor{block body example}{bg=tocsection!10!bookpaper, fg=black}

    % Footer configuration for beamer
    \setbeamertemplate{footline}{%
      \leavevmode%
      \hfill\usebeamerfont{page number in head/foot}%
      \insertframenumber{} / \inserttotalframenumber\hspace*{2ex}%
      \vskip1ex%
    }
  }{}%
}

%% ============================================
%% Misc utilities
%% ============================================
\usepackage{soul} % For highlighting text
\usepackage{fontawesome5} % For icons in presentations
\usepackage{etoolbox}
